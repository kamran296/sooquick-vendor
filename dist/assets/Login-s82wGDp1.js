import{r as A,a as r,j as e,y as o,b as F,u as U,c as q,d as $,L as O,e as P,f as R}from"./index-D4jZjNgn.js";import{F as z,a as B}from"./index-WlWpNLh2.js";import"./iconBase-BYpTOd7S.js";var K=A();const W=({email:n,tempToken:y,onSuccess:x,onClose:u})=>{const[c,f]=r.useState(["","","",""]),[b,g]=r.useState(!1),[h,w]=r.useState(300),[T,v]=r.useState(!1),i=r.useRef([]),j=c.every(t=>t!=="");r.useEffect(()=>{i.current[0]&&i.current[0].focus();const t=setInterval(()=>{w(s=>s<=1?(clearInterval(t),v(!0),0):s-1)},1e3);return()=>clearInterval(t)},[]);const N=(t,s)=>{if(!/^\d*$/.test(t))return;const a=[...c];a[s]=t,f(a),t!==""&&s<3&&i.current[s+1]?.focus()},k=(t,s)=>{if(t.key==="Backspace")if(c[s]===""&&s>0)i.current[s-1]?.focus();else{const a=[...c];a[s]="",f(a)}t.key==="ArrowLeft"&&s>0&&i.current[s-1]?.focus(),t.key==="ArrowRight"&&s<3&&i.current[s+1]?.focus()},S=t=>{t.preventDefault();const a=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,4);if(a.length===4){const D=a.split("");f(D),i.current[3]?.focus()}},L=async()=>{if(!j){o.error("Please enter the complete OTP");return}g(!0);try{const t=c.join(""),s=await F.verifyTwoFactor({otp:t,tempToken:y}),a=await s.data;s.status===200?x(a):o.error(a.message||"OTP verification failed")}catch(t){o.error(t.response?.data?.message||"An error occurred during OTP verification"),console.error("OTP verification error:",t),f(["","","",""]),i.current[0]?.focus(),u()}finally{g(!1)}},p=async()=>{if(T)try{o.info("Please try logging in again to receive a new OTP"),u()}catch{o.error("Failed to resend OTP")}},C=t=>{const s=Math.floor(t/60),a=t%60;return`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`};return e.jsx("div",{className:"bg-opacity-50 fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Two-Factor Authentication"}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"We've sent a 4-digit verification code to"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-gray-700",children:"Enter verification code"}),e.jsx("div",{className:"flex justify-center gap-3",children:c.map((t,s)=>e.jsx("input",{ref:a=>i.current[s]=a,type:"text",inputMode:"numeric",maxLength:1,value:t,onChange:a=>N(a.target.value,s),onKeyDown:a=>k(a,s),onPaste:s===0?S:void 0,className:"h-12 w-12 rounded-lg border border-gray-300 text-center text-xl font-semibold focus:border-green-500 focus:ring-2 focus:ring-green-500 focus:outline-none"},s))})]}),e.jsx("div",{className:"mb-6 text-center",children:h>0?e.jsxs("p",{className:"text-sm text-gray-500",children:["Code expires in"," ",e.jsx("span",{className:"font-medium",children:C(h)})]}):e.jsx("button",{onClick:p,className:"text-sm font-medium text-green-600 hover:text-green-700",children:"Resend code"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:u,disabled:b,className:"flex-1 rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:outline-none disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:L,disabled:!j||b,className:"flex-1 rounded-md border border-transparent bg-[#0b8263] px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",children:b?"Verifying...":"Verify"})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"For security reasons, this code will expire in 5 minutes"})})]})})},Y=({isOpen:n,onLogout:y,onCancel:x})=>(r.useEffect(()=>(n?(document.body.style.overflow="hidden",document.body.style.pointerEvents="none"):(document.body.style.overflow="unset",document.body.style.pointerEvents="auto"),()=>{document.body.style.overflow="unset",document.body.style.pointerEvents="auto"}),[n]),n?K.createPortal(e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 p-4",style:{pointerEvents:"auto"},children:e.jsxs("div",{className:"w-full max-w-sm rounded-xl bg-white p-6 shadow-2xl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Leave Application?"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"You're about to leave the authenticated area. Do you want to logout?"})]}),e.jsxs("div",{className:"mt-6 flex justify-center gap-3",children:[e.jsx("button",{onClick:x,className:"rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium hover:bg-gray-50",children:"Stay Logged In"}),e.jsx("button",{onClick:y,className:"rounded-lg bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700",children:"Logout"})]})]})}),document.body):null),J=()=>{const[n,y]=r.useState({email:"",password:""}),[x,u]=r.useState(!1),[c,f]=r.useState(!1),[b,g]=r.useState(!1),[h,w]=r.useState(null),[T,v]=r.useState(!1),[i,j]=r.useState(!1),N=U(),k=q(),{user:S}=$(l=>l.user),[L,p]=r.useState(!1),C=!!S.email;r.useEffect(()=>{console.log("User state:",S),C&&(console.log("User is authenticated, showing logout modal"),p(!0))},[C,S]);const t=async()=>{try{k(R());const l=await F.logout();console.log(l.data),p(!1),o.success("Logged out successfully")}catch(l){k(R()),console.error("Logout error:",l),p(!1)}},s=()=>{p(!1),N(P.dashboard)},a=l=>{const{name:m,value:d}=l.target;v(!1),y({...n,[m]:d})},D=async l=>{l.preventDefault(),u(!0);try{const m=await F.login({email:n.email,password:n.password}),d=await m.data;m.status===200?d.requires2FA?(w({tempToken:d.tempToken,userID:d.userId,email:n.email}),g(!0),o.info("Please enter the OTP sent to your email")):(o.success(d.message||"Login successful"),N(P.dashboard)):o.error(d.message||"Login failed")}catch(m){const d=m?.response?.status,E=m?.response?.data;if(d===403&&E?.code==="EMAIL_NOT_VERIFIED"){v(!0),o.warn(E.message||"Please verify your email");return}o.error(E?.message||"Invalid email or password"),console.error("Login error:",m)}finally{u(!1)}},I=l=>{o.success(l.message||"Login successful"),g(!1),w(null),N(P.dashboard,{replace:!0})},M=()=>{g(!1),w(null)},V=async()=>{try{j(!0),await F.resendVerification({email:n.email,role:"customer"}),o.success("Verification email resent successfully")}catch(l){o.error(l?.response?.data?.message||"Failed to resend verification email")}finally{v(!1),j(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-mont flex min-h-screen flex-col justify-center bg-gray-50 py-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Log into your account"})}),e.jsx("div",{className:"mt-8 p-3 sm:mx-auto sm:w-full sm:max-w-md md:max-w-xl",children:e.jsxs("div",{className:"bg-white px-4 py-8 shadow sm:rounded-lg sm:px-10",children:[e.jsxs("form",{className:"space-y-6",onSubmit:D,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",value:n.email,onChange:a,className:"block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-green-500 focus:ring-green-500 focus:outline-none sm:text-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{id:"password",name:"password",type:c?"text":"password",autoComplete:"new-password",value:n.password,onChange:a,className:"block w-full appearance-none rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 shadow-sm focus:border-green-500 focus:ring-green-500 focus:outline-none sm:text-sm"}),c?e.jsx(B,{className:"text-md absolute top-[0px] right-3 translate-y-1/2 bg-none text-gray-500",onClick:()=>f(!1)}):e.jsx(z,{className:"text-md absolute top-[0px] right-3 translate-y-1/2 bg-none text-gray-500",onClick:()=>f(!0)})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[T&&e.jsxs("div",{className:"mb-2 rounded-md border border-yellow-300 bg-yellow-50 p-3 text-sm text-yellow-800",children:[e.jsx("p",{children:"Your email is not verified."}),e.jsx("button",{type:"button",disabled:i,onClick:V,className:"mt-2 text-sm font-medium text-green-700 hover:underline disabled:opacity-50",children:i?"Resending...":"Resend verification email"})]}),e.jsx("button",{type:"submit",disabled:x,className:"flex w-full justify-center rounded-md border border-transparent bg-[#0b8263] px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",children:x?"Login...":"Login"})]})]}),e.jsx("div",{className:"relative mt-2 flex justify-end text-sm",children:e.jsx(O,{to:"/forget-password",className:"bg-white px-2 text-gray-500 hover:text-blue-500",children:"Forget Password"})}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"bg-white px-2 text-gray-500",children:"Create an account?"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(O,{to:"/signup",className:"flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:outline-none",children:"Sign Up"})})]})]})})]}),b&&h&&e.jsx(W,{email:h.email,tempToken:h.tempToken,onSuccess:I,onClose:M}),L&&e.jsx(Y,{isOpen:L,onLogout:t,onCancel:s})]})};export{J as default};
