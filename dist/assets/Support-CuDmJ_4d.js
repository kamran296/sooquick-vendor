import{a as l,c as $,s as P,j as e,y as n,b as j}from"./index-jiLBgY-x.js";import{g as B,h as A,i as c,j as I,k as R,l as z,m as G,n as O,f as Y}from"./index-fdmEMm9Z.js";import{U as H,B as J}from"./UserLayout-CWIJ85M-.js";import"./iconBase-BrWCdWEL.js";import"./index-NmB-QN9r.js";import"./index-B0r-wx_s.js";const ee=()=>{const[i,N]=l.useState("all"),[y,p]=l.useState([]),[h,o]=l.useState(!1),[a,d]=l.useState(null),[g,m]=l.useState(!1),[x,v]=l.useState(""),[w,S]=l.useState(!1),D=$(),[u,T]=l.useState({subject:"",message:""});l.useEffect(()=>{D(P(4))},[]),l.useEffect(()=>{(async()=>{o(!0);try{const t=await j.getAllSupportTickets();p(t.data.tickets||[])}catch(t){console.error("Failed to fetch tickets:",t)}finally{o(!1)}})()},[]);const U=async s=>{s.preventDefault(),o(!0);try{const t=await j.createSupportTicket(u);if(!t.data.success)throw new Error(t.data.error||"Failed to create ticket");const r=t.data.ticket;p([r,...y]),T({subject:"",message:""}),m(!1),d(r),N("all"),n.success("Support ticket submitted successfully!")}catch(t){console.error("Failed to submit ticket:",t),n.error(t.response?.data?.error||"Failed to submit ticket. Please try again.")}finally{o(!1)}},_=async s=>{if(s.preventDefault(),!(!x.trim()||!a)){S(!0);try{const t=await j.addMessageToTicket(a._id,{message:x.trim()});if(t.data.success){const r=t.data.ticket;d(r),p(L=>L.map(M=>M._id===r._id?r:M)),v(""),n.success("Message sent successfully!")}}catch(t){console.error("Failed to send message:",t),n.error("Failed to send message. Please try again.")}finally{S(!1)}}},C=s=>{T({...u,[s.target.name]:s.target.value})},q=s=>{switch(s){case"open":return e.jsx(Y,{className:"text-orange-500"});case"in-progress":return e.jsx(O,{className:"text-blue-500"});case"closed":return e.jsx(G,{className:"text-green-500"});default:return e.jsx(c,{className:"text-gray-500"})}},k=s=>{switch(s){case"open":return"bg-orange-100 text-orange-800";case"in-progress":return"bg-blue-100 text-blue-800";case"closed":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},b=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),E=s=>!s.messages||s.messages.length===0?s.createdAt:s.messages[s.messages.length-1].createdAt,f=s=>s.messages?s.messages.filter(t=>t.senderModel==="Admin").length:0,F=y.filter(s=>i==="open"?s.status==="open":i==="in-progress"?s.status==="in-progress":i==="closed"?s.status==="closed":!0);return e.jsx(H,{children:e.jsx("div",{className:"min-h-screen bg-white px-4 py-8 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto max-w-5xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-center",children:[e.jsx(J,{className:"mr-3 text-4xl text-[#0b8263]"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Support Center"})]}),e.jsx("p",{className:"text-lg text-slate-600",children:"Get help with your questions and issues"}),e.jsxs("div",{className:"mt-1 flex w-full items-center justify-center gap-3 text-xs font-bold text-slate-600",children:[e.jsxs("div",{children:[" ","Email:"," ",e.jsx("a",{href:"mailto:customersupport@sooquick.com",children:"customersupport@sooquick.com"})]}),e.jsx("p",{className:"hover:cursor-pointer",onClick:()=>{navigator.clipboard.writeText("+919650309376"),n.success("Contact number copied to clipboard!")},children:"Contact: +919650309376"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsx("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:()=>m(!g),className:"flex items-center space-x-2 rounded-lg bg-[#0b8263] px-4 py-2 text-white transition-colors hover:bg-emerald-700",children:[e.jsx(B,{className:"text-lg"}),e.jsx("span",{children:"New Ticket"})]})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:"all",label:"All Tickets"},{id:"open",label:"Open"},{id:"in-progress",label:"In Progress"},{id:"closed",label:"Closed"}].map(s=>e.jsx("button",{onClick:()=>N(s.id),className:`rounded-full px-3 py-1 text-sm font-medium transition-colors ${i===s.id?"bg-[#0b8263] text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,children:s.label},s.id))})]})}),g&&e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-slate-800",children:"Create New Support Ticket"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"Subject"}),e.jsx("input",{type:"text",name:"subject",value:u.subject,onChange:C,placeholder:"Brief description of your issue",className:"w-full rounded-lg border border-slate-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263] focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"Message"}),e.jsx("textarea",{name:"message",value:u.message,onChange:C,rows:"4",placeholder:"Please describe your issue in detail...",className:"w-full resize-none rounded-lg border border-slate-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263] focus:outline-none",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 text-slate-600 transition-colors hover:text-slate-800",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:h,className:"flex items-center space-x-2 rounded-lg bg-[#0b8263] px-6 py-2 text-white transition-colors hover:bg-emerald-700 disabled:opacity-50",children:[e.jsx(A,{className:"text-sm"}),e.jsx("span",{children:h?"Submitting...":"Submit Ticket"})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:h?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-b-2 border-[#0b8263]"}),e.jsx("p",{className:"mt-2 text-slate-600",children:"Loading tickets..."})]}):F.length===0?e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white py-8 text-center",children:[e.jsx(c,{className:"mx-auto mb-3 text-4xl text-slate-400"}),e.jsx("p",{className:"text-slate-600",children:"No tickets found"}),!g&&e.jsx("button",{onClick:()=>m(!0),className:"mt-2 text-[#0b8263] hover:text-emerald-700",children:"Create your first ticket"})]}):F.map(s=>e.jsxs("div",{className:`cursor-pointer rounded-lg border border-slate-200 bg-white p-4 shadow-sm transition-all hover:shadow-md ${a?._id===s._id?"ring-2 ring-[#0b8263]":""}`,onClick:()=>d(s),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-2 flex items-center space-x-3",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[q(s.status),e.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-medium ${k(s.status)}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1).replace("-"," ")})]}),s.assignedTo&&e.jsx("span",{className:"text-xs text-slate-500",children:"Assigned"})]}),e.jsx("h3",{className:"mb-1 font-semibold text-slate-800",children:s.subject}),e.jsx("p",{className:"mb-2 line-clamp-2 text-sm text-slate-600",children:s.messages&&s.messages.length>0?s.messages[0].message:"No messages"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Type: ",s.type]}),e.jsxs("span",{children:["Last activity:"," ",b(E(s))]})]})]}),e.jsx("div",{className:"ml-4",children:a?._id===s._id?e.jsx(I,{className:"text-slate-400"}):e.jsx(R,{className:"text-slate-400"})})]}),s.messages&&s.messages.length>0&&e.jsx("div",{className:"mt-3 border-t border-slate-100 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(c,{className:"text-sm"}),e.jsxs("span",{children:[s.messages.length," message",s.messages.length!==1?"s":""]})]}),f(s)>0&&e.jsxs("span",{className:"text-[#0b8263]",children:[f(s)," admin response",f(s)!==1?"s":""]})]})})]},s._id))})]}),e.jsx("div",{className:"lg:col-span-1",children:a?e.jsxs("div",{className:"sticky top-4 rounded-lg border border-slate-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b border-slate-200 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-800",children:"Ticket Details"}),e.jsx("button",{onClick:()=>d(null),className:"text-slate-400 hover:text-slate-600",children:"Ã—"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-medium ${k(a.status)}`,children:a.status.replace("-"," ")}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Created ",b(a.createdAt)]})]})]}),e.jsx("div",{className:"max-h-96 space-y-4 overflow-y-auto p-4",children:a.messages&&a.messages.length>0?a.messages.map((s,t)=>e.jsxs("div",{className:`rounded-lg p-3 ${s.senderModel==="User"?"bg-slate-50":"bg-[#0b8263]/10"}`,children:[e.jsxs("div",{className:"mb-2 flex items-center space-x-2",children:[e.jsx("div",{className:`flex h-6 w-6 items-center justify-center rounded-full ${s.senderModel==="User"?"bg-slate-300":"bg-[#0b8263]"}`,children:s.senderModel==="User"?e.jsx(z,{className:"text-xs text-slate-600"}):e.jsx("span",{className:"text-xs font-medium text-white",children:"S"})}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:s.senderModel==="User"?"You":"Support Team"}),e.jsx("span",{className:"text-xs text-slate-500",children:b(s.createdAt)})]}),e.jsx("p",{className:"text-sm text-slate-700",children:s.message})]},t)):e.jsxs("div",{className:"py-4 text-center",children:[e.jsx(c,{className:"mx-auto mb-2 text-2xl text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No messages yet"})]})}),a.status!=="closed"&&e.jsx("div",{className:"border-t border-slate-200 p-4",children:e.jsxs("form",{onSubmit:_,className:"space-y-3",children:[e.jsx("textarea",{value:x,onChange:s=>v(s.target.value),placeholder:"Type your message...",rows:"3",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-transparent focus:ring-2 focus:ring-[#0b8263] focus:outline-none"}),e.jsxs("button",{type:"submit",disabled:!x.trim()||w,className:"flex w-full items-center justify-center space-x-2 rounded-lg bg-[#0b8263] px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-emerald-700 disabled:opacity-50",children:[e.jsx(A,{className:"text-sm"}),w?"Sending...":"Send Message"]})]})})]}):e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-6 text-center shadow-sm",children:[e.jsx(c,{className:"mx-auto mb-3 text-3xl text-slate-400"}),e.jsx("h3",{className:"mb-2 font-semibold text-slate-700",children:"No Ticket Selected"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Select a ticket from the list to view details and responses"})]})})]})]})})})};export{ee as default};
