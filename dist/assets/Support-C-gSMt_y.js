import{a as l,c as $,s as q,j as e,b as f,y as u}from"./index-D4jZjNgn.js";import{g as E,h as k,i as n,j as P,k as B,l as I,m as R,n as z,f as G}from"./index-HyJOQJdU.js";import{U as O,B as Y}from"./UserLayout-DyKtNi4q.js";import"./iconBase-BYpTOd7S.js";import"./index-WlWpNLh2.js";import"./index-CWru-PtX.js";const X=()=>{const[c,N]=l.useState("all"),[y,p]=l.useState([]),[h,i]=l.useState(!1),[a,d]=l.useState(null),[g,o]=l.useState(!1),[x,v]=l.useState(""),A=$(),[m,w]=l.useState({subject:"",message:""});l.useEffect(()=>{A(q(4))},[]),l.useEffect(()=>{(async()=>{i(!0);try{const t=await f.getAllSupportTickets();p(t.data.tickets||[])}catch(t){console.error("Failed to fetch tickets:",t)}finally{i(!1)}})()},[]);const M=async s=>{s.preventDefault(),i(!0);try{const t=await f.createSupportTicket(m);if(!t.data.success)throw new Error(t.data.error||"Failed to create ticket");const r=t.data.ticket;p([r,...y]),w({subject:"",message:""}),o(!1),d(r),N("all"),u.success("Support ticket submitted successfully!")}catch(t){console.error("Failed to submit ticket:",t),u.error(t.response?.data?.error||"Failed to submit ticket. Please try again.")}finally{i(!1)}},D=async s=>{if(s.preventDefault(),!(!x.trim()||!a))try{const t=await f.addMessageToTicket(a._id,{message:x.trim()});if(t.data.success){const r=t.data.ticket;d(r),p(L=>L.map(F=>F._id===r._id?r:F)),v(""),u.success("Message sent successfully!")}}catch(t){console.error("Failed to send message:",t),u.error("Failed to send message. Please try again.")}},S=s=>{w({...m,[s.target.name]:s.target.value})},U=s=>{switch(s){case"open":return e.jsx(G,{className:"text-orange-500"});case"in-progress":return e.jsx(z,{className:"text-blue-500"});case"closed":return e.jsx(R,{className:"text-green-500"});default:return e.jsx(n,{className:"text-gray-500"})}},T=s=>{switch(s){case"open":return"bg-orange-100 text-orange-800";case"in-progress":return"bg-blue-100 text-blue-800";case"closed":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},b=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),_=s=>!s.messages||s.messages.length===0?s.createdAt:s.messages[s.messages.length-1].createdAt,j=s=>s.messages?s.messages.filter(t=>t.senderModel==="Admin").length:0,C=y.filter(s=>c==="open"?s.status==="open":c==="in-progress"?s.status==="in-progress":c==="closed"?s.status==="closed":!0);return e.jsx(O,{children:e.jsx("div",{className:"min-h-screen bg-white px-4 py-8 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto max-w-5xl",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-center",children:[e.jsx(Y,{className:"mr-3 text-4xl text-[#0b8263]"}),e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Support Center"})]}),e.jsx("p",{className:"text-lg text-slate-600",children:"Get help with your questions and issues"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsx("div",{className:"rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:()=>o(!g),className:"flex items-center space-x-2 rounded-lg bg-[#0b8263] px-4 py-2 text-white transition-colors hover:bg-emerald-700",children:[e.jsx(E,{className:"text-lg"}),e.jsx("span",{children:"New Ticket"})]})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{id:"all",label:"All Tickets"},{id:"open",label:"Open"},{id:"in-progress",label:"In Progress"},{id:"closed",label:"Closed"}].map(s=>e.jsx("button",{onClick:()=>N(s.id),className:`rounded-full px-3 py-1 text-sm font-medium transition-colors ${c===s.id?"bg-[#0b8263] text-white":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,children:s.label},s.id))})]})}),g&&e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-6 shadow-sm",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-slate-800",children:"Create New Support Ticket"}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"Subject"}),e.jsx("input",{type:"text",name:"subject",value:m.subject,onChange:S,placeholder:"Brief description of your issue",className:"w-full rounded-lg border border-slate-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263] focus:outline-none",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-slate-700",children:"Message"}),e.jsx("textarea",{name:"message",value:m.message,onChange:S,rows:"4",placeholder:"Please describe your issue in detail...",className:"w-full resize-none rounded-lg border border-slate-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263] focus:outline-none",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 text-slate-600 transition-colors hover:text-slate-800",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:h,className:"flex items-center space-x-2 rounded-lg bg-[#0b8263] px-6 py-2 text-white transition-colors hover:bg-emerald-700 disabled:opacity-50",children:[e.jsx(k,{className:"text-sm"}),e.jsx("span",{children:h?"Submitting...":"Submit Ticket"})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:h?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"mx-auto h-8 w-8 animate-spin rounded-full border-b-2 border-[#0b8263]"}),e.jsx("p",{className:"mt-2 text-slate-600",children:"Loading tickets..."})]}):C.length===0?e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white py-8 text-center",children:[e.jsx(n,{className:"mx-auto mb-3 text-4xl text-slate-400"}),e.jsx("p",{className:"text-slate-600",children:"No tickets found"}),!g&&e.jsx("button",{onClick:()=>o(!0),className:"mt-2 text-[#0b8263] hover:text-emerald-700",children:"Create your first ticket"})]}):C.map(s=>e.jsxs("div",{className:`cursor-pointer rounded-lg border border-slate-200 bg-white p-4 shadow-sm transition-all hover:shadow-md ${a?._id===s._id?"ring-2 ring-[#0b8263]":""}`,onClick:()=>d(s),children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-2 flex items-center space-x-3",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[U(s.status),e.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-medium ${T(s.status)}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1).replace("-"," ")})]}),s.assignedTo&&e.jsx("span",{className:"text-xs text-slate-500",children:"Assigned"})]}),e.jsx("h3",{className:"mb-1 font-semibold text-slate-800",children:s.subject}),e.jsx("p",{className:"mb-2 line-clamp-2 text-sm text-slate-600",children:s.messages&&s.messages.length>0?s.messages[0].message:"No messages"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Type: ",s.type]}),e.jsxs("span",{children:["Last activity:"," ",b(_(s))]})]})]}),e.jsx("div",{className:"ml-4",children:a?._id===s._id?e.jsx(P,{className:"text-slate-400"}):e.jsx(B,{className:"text-slate-400"})})]}),s.messages&&s.messages.length>0&&e.jsx("div",{className:"mt-3 border-t border-slate-100 pt-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(n,{className:"text-sm"}),e.jsxs("span",{children:[s.messages.length," message",s.messages.length!==1?"s":""]})]}),j(s)>0&&e.jsxs("span",{className:"text-[#0b8263]",children:[j(s)," admin response",j(s)!==1?"s":""]})]})})]},s._id))})]}),e.jsx("div",{className:"lg:col-span-1",children:a?e.jsxs("div",{className:"sticky top-4 rounded-lg border border-slate-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b border-slate-200 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-slate-800",children:"Ticket Details"}),e.jsx("button",{onClick:()=>d(null),className:"text-slate-400 hover:text-slate-600",children:"Ã—"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-medium ${T(a.status)}`,children:a.status.replace("-"," ")}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Created ",b(a.createdAt)]})]})]}),e.jsx("div",{className:"max-h-96 space-y-4 overflow-y-auto p-4",children:a.messages&&a.messages.length>0?a.messages.map((s,t)=>e.jsxs("div",{className:`rounded-lg p-3 ${s.senderModel==="User"?"bg-slate-50":"bg-[#0b8263]/10"}`,children:[e.jsxs("div",{className:"mb-2 flex items-center space-x-2",children:[e.jsx("div",{className:`flex h-6 w-6 items-center justify-center rounded-full ${s.senderModel==="User"?"bg-slate-300":"bg-[#0b8263]"}`,children:s.senderModel==="User"?e.jsx(I,{className:"text-xs text-slate-600"}):e.jsx("span",{className:"text-xs font-medium text-white",children:"S"})}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:s.senderModel==="User"?"You":"Support Team"}),e.jsx("span",{className:"text-xs text-slate-500",children:b(s.createdAt)})]}),e.jsx("p",{className:"text-sm text-slate-700",children:s.message})]},t)):e.jsxs("div",{className:"py-4 text-center",children:[e.jsx(n,{className:"mx-auto mb-2 text-2xl text-slate-400"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No messages yet"})]})}),a.status!=="closed"&&e.jsx("div",{className:"border-t border-slate-200 p-4",children:e.jsxs("form",{onSubmit:D,className:"space-y-3",children:[e.jsx("textarea",{value:x,onChange:s=>v(s.target.value),placeholder:"Type your message...",rows:"3",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-transparent focus:ring-2 focus:ring-[#0b8263] focus:outline-none"}),e.jsxs("button",{type:"submit",disabled:!x.trim(),className:"flex w-full items-center justify-center space-x-2 rounded-lg bg-[#0b8263] px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-emerald-700 disabled:opacity-50",children:[e.jsx(k,{className:"text-sm"}),e.jsx("span",{children:"Send Message"})]})]})})]}):e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white p-6 text-center shadow-sm",children:[e.jsx(n,{className:"mx-auto mb-3 text-3xl text-slate-400"}),e.jsx("h3",{className:"mb-2 font-semibold text-slate-700",children:"No Ticket Selected"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Select a ticket from the list to view details and responses"})]})})]})]})})})};export{X as default};
