import{d as Y,a as n,u as K,c as Q,s as V,j as e,e as G,b as B,y as x}from"./index-jiLBgY-x.js";import{K as S,l as N,P as J,Q as X,R as Z,S as ee,z as se,n as H,A as ae,T as te,U as re}from"./index-NmB-QN9r.js";import{U as L}from"./UserLayout-CWIJ85M-.js";import{b as le}from"./helpers-DDDbmMMy.js";import"./iconBase-BrWCdWEL.js";import"./index-B0r-wx_s.js";const fe=()=>{const{user:ne}=Y(s=>s.user),[g,M]=n.useState("all"),[y,R]=n.useState(""),[t,I]=n.useState(null),[U,T]=n.useState(!0),[A,i]=n.useState(null),[_,p]=n.useState(!1),[o,f]=n.useState(""),[v,D]=n.useState(!1),E=K(),W=Q();n.useEffect(()=>{W(V(3))},[]);const P=t?.transactions?.filter(s=>{const r=g==="all"||s.type===g,b=s.description.toLowerCase().includes(y.toLowerCase());return r&&b}).slice().reverse()||[],$=s=>{switch(s){case"membership_purchase":return e.jsx(re,{className:"text-purple-500"});case"service_payment":return e.jsx(H,{className:"text-blue-500"});case"refund":return e.jsx(te,{className:"text-green-500"});case"reward_points":return e.jsx(ae,{className:"text-yellow-500"});case"cashout":return e.jsx(N,{className:"text-red-500"});default:return e.jsx(S,{className:"text-gray-500"})}},q=(s,r)=>s==="cashout"?"text-red-600":r>0?"text-green-600":r<0?"text-red-600":"text-gray-600",z=s=>({refund:"Refund",reward_points:"Reward Points",cashout:"Cashout"})[s]||s,d=s=>{const r=t?.currency||"INR";return new Intl.NumberFormat("en-IN",{style:"currency",currency:r,minimumFractionDigits:0}).format(s)},F=async()=>{try{T(!0),i(null);const s=await B.getWallet();I(s.data)}catch(s){console.error("Error fetching wallet:",s),i("Failed to load wallet data. Please try again."),I({balance:0,rewardPoints:0,currency:"INR",transactions:[]})}finally{T(!1)}},w=(()=>{if(!t?.transactions)return{totalCredit:0,totalDebit:0,totalTransactions:0};const s=t.transactions,r=s.filter(c=>c.amount>0&&c.type!=="reward_points"&&c.type!=="cashout"&&c.type!=="purchase").reduce((c,k)=>c+k.amount,0),b=s.filter(c=>c.amount<0||c.type==="cashout").reduce((c,k)=>c+Math.abs(k.amount),0);return{totalCredit:r,totalDebit:b,totalTransactions:s.length}})();n.useEffect(()=>{F()},[]);const[l,u]=n.useState(1),[a,C]=n.useState({accountHolderName:"",accountNumber:"",ifscCode:"",bankName:"",upiId:""}),[m,j]=n.useState("bank"),[ie,oe]=n.useState([]),[de,me]=n.useState(null),O=async()=>{if(!o||o<=0){x.error("Please enter a valid amount"),i("Please enter a valid amount");return}if(o>t.balance){x.error("Insufficient balance"),i("Insufficient balance");return}if(l===1){u(2);return}if(l===2){if(m==="bank"){if(!a.accountHolderName||!a.accountNumber||!a.ifscCode){x.error("Please fill all required bank details"),i("Please fill all required bank details");return}}else if(!a.upiId){x.error("Please enter UPI ID"),i("Please enter UPI ID");return}u(3);return}try{D(!0);const s={amount:parseFloat(o),type:"Vendor",bankDetails:m==="bank"?{accountHolderName:a.accountHolderName,accountNumber:a.accountNumber,ifscCode:a.ifscCode,bankName:a.bankName}:{upiId:a.upiId}},r=await B.cashoutWallet(s);r.data.success?(x.success(r.message||"Cashout request submitted successfully!"),p(!1),f(""),C({accountHolderName:"",accountNumber:"",ifscCode:"",bankName:"",upiId:""}),u(1),j("bank"),i(null),await F()):(console.log(r.data,"ee"),x.error(r.data.message||"Cashout failed"),i(r.data.message||"Cashout failed"))}catch(s){console.error("Cashout error:",s),p(!1),x.error(s.response.data.message||"Cashout failed. Please try again."),i(s.response.data.message||"Cashout failed. Please try again.")}finally{D(!1)}},h=(s,r)=>{C(b=>({...b,[s]:r}))};return U?e.jsx(L,{children:e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 animate-spin rounded-full border-b-2 border-[#0b8263]"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading wallet..."})]})})}):e.jsxs(L,{children:[e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-4",children:[A&&e.jsx("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 p-4",children:e.jsx("p",{className:"text-red-700",children:A})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"mb-2 text-3xl font-bold text-gray-900",children:"My Wallet"}),e.jsx("p",{className:"text-gray-600",children:"Manage your balance and track transactions"})]}),e.jsx("div",{className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"rounded-2xl border-l-4 border-l-[#0b8263] bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Current Balance"}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:d(t?.balance||0)})]}),e.jsx("div",{className:"rounded-full bg-[#0b8263] p-3",children:e.jsx(S,{className:"text-2xl text-white"})})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:()=>p(!0),className:"flex flex-1 items-center justify-center gap-2 rounded-lg bg-[#0b8263] px-4 py-2 font-medium text-white transition-colors hover:bg-[#096b52]",children:[e.jsx(N,{className:"text-sm"}),"Cash Out"]})})]})}),e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg bg-green-100 p-2",children:e.jsx(J,{className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Credit"}),e.jsx("p",{className:"font-semibold text-gray-900",children:d(w.totalCredit)})]})]})}),e.jsx("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg bg-red-100 p-2",children:e.jsx(X,{className:"text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Debit"}),e.jsx("p",{className:"font-semibold text-gray-900",children:d(w.totalDebit)})]})]})}),e.jsx("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-lg bg-blue-100 p-2",children:e.jsx(Z,{className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Transactions"}),e.jsx("p",{className:"font-semibold text-gray-900",children:w.totalTransactions})]})]})})]}),e.jsxs("div",{className:"overflow-hidden rounded-2xl bg-white shadow-lg",children:[e.jsx("div",{className:"border-b border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col justify-between gap-4 md:flex-row md:items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Transaction History"}),e.jsx("p",{className:"text-gray-600",children:"All your wallet transactions in one place"})]}),e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute top-1/2 left-3 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search transactions...",className:"rounded-lg border border-gray-300 py-2 pr-4 pl-10 focus:border-transparent focus:ring-2 focus:ring-[#0b8263] focus:outline-none",value:y,onChange:s=>R(s.target.value)})]})})]})}),e.jsx("div",{className:"border-b border-gray-200 px-6 pt-4",children:e.jsx("div",{className:"flex space-x-1 overflow-x-auto",children:[{id:"all",label:"All",count:t?.transactions?.length||0},{id:"refund",label:"Refunds",count:t?.transactions?.filter(s=>s.type==="refund").length||0},{id:"reward_points",label:"Rewards",count:t?.transactions?.filter(s=>s.type==="reward_points").length||0},{id:"cashout",label:"Cashout",count:t?.transactions?.filter(s=>s.type==="cashout").length||0}].map(s=>e.jsxs("button",{className:`flex-shrink-0 rounded-t-lg px-4 py-2 font-medium whitespace-nowrap transition-colors ${g===s.id?"bg-[#0b8263] text-white":"text-gray-600 hover:bg-gray-100 hover:text-[#0b8263]"}`,onClick:()=>M(s.id),children:[s.label," (",s.count,")"]},s.id))})}),e.jsx("div",{className:"divide-y divide-gray-100",children:P.length>0?P.map(s=>e.jsx("div",{className:"p-6 transition-colors hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"rounded-lg bg-gray-100 p-3",children:$(s.type)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.description}),e.jsxs("p",{className:"text-sm text-gray-600",children:[le(s.createdAt)," • Balance: ",d(s.balanceAfter)]}),s.referenceId&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Ref: ",s.referenceId]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-lg font-semibold ${q(s.type,s.amount)}`,children:[s.amount>0&&s.type==="cashout"||s.type==="refund"||s.type==="service_completion"?"+":s.type==="purchase"?"-":"",d(s.amount)]}),e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ${s.type==="membership_purchase"?"bg-purple-100 text-purple-800":s.type==="service_payment"?"bg-blue-100 text-blue-800":s.type==="refund"?"bg-green-100 text-green-800":s.type==="reward_points"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:z(s.type)})]})]})},s._id)):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(S,{className:"mx-auto mb-4 text-4xl text-gray-300"}),e.jsx("h3",{className:"mb-2 text-lg font-semibold text-gray-900",children:"No transactions found"}),e.jsx("p",{className:"text-gray-600",children:y||g!=="all"?"Try changing your filters or search term":"Your transaction history will appear here"})]})})]}),e.jsx("div",{className:"mt-8 rounded-2xl bg-gradient-to-r from-[#0b8263] to-[#096b52] p-6 text-white",children:e.jsxs("div",{className:"flex flex-col items-center justify-between md:flex-row",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 text-xl font-bold",children:"Need help with your wallet?"}),e.jsx("p",{className:"opacity-90",children:"Contact our support team for any wallet-related queries"})]}),e.jsx("button",{onClick:()=>E(G.support),className:"mt-4 rounded-lg bg-white px-6 py-2 font-semibold text-[#0b8263] transition-colors hover:bg-gray-100 md:mt-0",children:"Contact Support"})]})})]})}),_&&e.jsx("div",{className:"bg-opacity-50 fixed inset-0 z-50 flex items-center justify-center bg-black/30 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[l===1&&"Cash Out Amount",l===2&&"Bank Details",l===3&&"Confirm Cashout"]}),e.jsx("button",{onClick:()=>{p(!1),u(1),f(""),C({accountHolderName:"",accountNumber:"",ifscCode:"",bankName:"",upiId:""}),j("bank"),i(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex flex-1 flex-col items-center",children:[e.jsx("div",{className:`flex h-8 w-8 items-center justify-center rounded-full border-2 ${l>=s?"border-[#0b8263] bg-[#0b8263] text-white":"border-gray-300 text-gray-300"}`,children:s}),e.jsx("span",{className:`mt-2 text-xs ${l>=s?"text-[#0b8263]":"text-gray-400"}`,children:s===1?"Amount":s===2?"Details":"Confirm"})]},s))}),e.jsx("div",{className:"relative -top-4 -z-10 mx-auto h-0.5 w-3/4 bg-gray-200",children:e.jsx("div",{className:"h-full bg-[#0b8263] transition-all duration-300",style:{width:`${(l-1)/2*100}%`}})})]}),l===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Amount to Cash Out"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute top-1/2 left-3 -translate-y-1/2 transform text-gray-400"}),e.jsx("input",{type:"number",value:o,onChange:s=>f(s.target.value),placeholder:"Enter amount",className:"w-full rounded-lg border border-gray-300 py-3 pr-4 pl-10 focus:border-transparent focus:ring-2 focus:ring-[#0b8263]",max:t?.balance,min:"1"})]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Available balance: ",d(t?.balance||0)]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[500,1e3,2e3,5e3,1e4,t?.balance].map(s=>e.jsx("button",{disabled:s>t?.balance,onClick:()=>f(s===t?.balance?t.balance:s),className:`rounded-lg border py-2 text-sm font-medium transition-colors ${o==s?"border-[#0b8263] bg-[#0b8263] text-white":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:s===t?.balance?"Max":d(s)},s))})]}),l===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-3 block text-sm font-medium text-gray-700",children:"Payment Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>j("bank"),className:`rounded-lg border p-3 text-center transition-colors ${m==="bank"?"border-[#0b8263] bg-[#0b8263] text-white":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(H,{className:"mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"Bank Transfer"})]}),e.jsxs("button",{onClick:()=>j("upi"),className:`rounded-lg border p-3 text-center transition-colors ${m==="upi"?"border-[#0b8263] bg-[#0b8263] text-white":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(N,{className:"mx-auto mb-1"}),e.jsx("span",{className:"text-sm",children:"UPI"})]})]})]}),m==="bank"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Account Holder Name *"}),e.jsx("input",{type:"text",value:a.accountHolderName,onChange:s=>h("accountHolderName",s.target.value),placeholder:"Enter account holder name",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Account Number *"}),e.jsx("input",{type:"text",value:a.accountNumber,onChange:s=>h("accountNumber",s.target.value.replace(/\D/g,"")),placeholder:"Enter account number",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263]",maxLength:18})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"IFSC Code *"}),e.jsx("input",{type:"text",value:a.ifscCode,onChange:s=>h("ifscCode",s.target.value.toUpperCase()),placeholder:"IFSC Code",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263]",maxLength:11})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Bank Name"}),e.jsx("input",{type:"text",value:a.bankName,onChange:s=>h("bankName",s.target.value),placeholder:"Bank name",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263]"})]})]})]}),m==="upi"&&e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"UPI ID *"}),e.jsx("input",{type:"text",value:a.upiId,onChange:s=>h("upiId",s.target.value),placeholder:"yourname@upi",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-transparent focus:ring-2 focus:ring-[#0b8263]"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter your UPI ID for instant transfer"})]})]}),l===3&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg bg-green-50 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"rounded-full bg-green-100 p-2",children:e.jsx(N,{className:"text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"font-semibold text-green-800",children:"Cashout Summary"}),e.jsx("p",{className:"text-sm text-green-700",children:"Review your cashout details before confirming"})]})]})}),e.jsxs("div",{className:"space-y-3 rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsx("span",{className:"font-semibold",children:d(o)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Method:"}),e.jsxs("span",{className:"font-semibold capitalize",children:[m," Transfer"]})]}),m==="bank"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Account Holder:"}),e.jsx("span",{className:"font-semibold",children:a.accountHolderName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Account Number:"}),e.jsxs("span",{className:"font-semibold",children:["****",a.accountNumber.slice(-4)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"IFSC Code:"}),e.jsx("span",{className:"font-semibold",children:a.ifscCode})]})]}):e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"UPI ID:"}),e.jsx("span",{className:"font-semibold",children:a.upiId})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:d(o)})]})})]}),e.jsx("div",{className:"rounded-lg bg-yellow-50 p-3",children:e.jsx("p",{className:"text-xs text-yellow-800",children:"⏰ Cashout requests are processed within 24-48 hours. You'll receive a confirmation once processed."})})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[l>1&&e.jsx("button",{onClick:()=>u(l-1),className:"flex-1 rounded-lg border border-gray-300 px-4 py-3 text-gray-700 transition-colors hover:bg-gray-50",disabled:v,children:"Back"}),e.jsx("button",{onClick:O,disabled:v||l===1&&!o,className:"flex-1 rounded-lg bg-[#0b8263] px-4 py-3 font-medium text-white transition-colors hover:bg-[#096b52] disabled:cursor-not-allowed disabled:opacity-50",children:v?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Processing..."]}):l===3?"Confirm Cashout":"Continue"})]})]})})]})};export{fe as default};
